<%- include('partials/head.ejs') %>
<body class="create-story">

	<section class="map-visualisation">
		Map visualisation here
	</section>

	<nav class="table-of-contents">
		<ol>
			<% for(var i = 0; i < Object.keys(dataFirstQuery.years).length; i++) { %>
				<li class="year">
					<h1><%- Object.keys(dataFirstQuery.years)[i] %></h1>
					<% var objectYears = dataFirstQuery.years[Object.keys(dataFirstQuery.years)[i]]; %>
					<% for(var j = 0; j < Object.keys(objectYears).length; j++) { %>
						<h2><%- Object.keys(objectYears)[j] %></h2>
					<% } %>
					<button class="add-chapter-btn" type="button">+</button>
				</li>
			<% } %>
		</ol>
	</nav>


	<section class="intro">
		<h1>Maak jouw eigen verhaal</h1>
		<form class="user-data" action="/" method="post">
			<label for="name">Vul hier jouw naam in</label>
			<input id="name" name="name" type="text" placeholder="Jan Jansen.." />
			<label for="year">Vul hier jouw geboortejaar in</label>
			<input id="year" name="year" type="number" placeholder="1969" min="1900" max="2017" />
			<button type="submit">Maak een verhaal</button>
		</form>
	</section>

	<!-- Create a section for each selected year: -->
	<% for(var i = 0; i < Object.keys(dataFirstQuery.years).length; i++) { %>
		<section class="year">
			<h1><%- Object.keys(dataFirstQuery.years)[i] %></h1>

			<% var objectYears = dataFirstQuery.years[Object.keys(dataFirstQuery.years)[i]]; %>
			<% for(var j = 0; j < Object.keys(objectYears).length; j++) { %>

				<%- include('partials/chapter.ejs', {i: i, j: j, objectYears: objectYears}) %>

			<% } %>
		</section>
	<% } %>

	<script>
		window.data = <%- JSON.stringify(dataFirstQuery || null) %>;
		console.log(window.data)
	</script>
	<script>
		var trigger = document.querySelectorAll('.openDetail');
		var detailpopup = document.querySelectorAll('.detail');
		var closeButton = document.querySelectorAll('.popupCloseButton');

		for(var i = 0; i < trigger.length; i++) {
			trigger[i].addEventListener('click', function(e){
				e.preventDefault();
				e.path[3].childNodes[3].classList.add('show');
			});

			detailpopup[i].addEventListener('click', function(e){
				e.preventDefault();
				e.target.parentElement.classList.remove('show')
			});

			closeButton[i].addEventListener('click', function(e){
				e.preventDefault();
				e.target.parentElement.parentElement.classList.remove('show')
			});
		}
	</script>

<%- include('partials/foot.ejs') %>
